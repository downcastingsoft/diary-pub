# 初期化時に何が起こるのか (C++11)

## はじめに

`[dcl.init]/16` はたいへん読みにくいです.
実際にプログラムを書いていて必要になるのは,
「このデータ型のオブジェクトまたはリファレンスをこのような形態で初期化するにはどのように初期化子を書けばよいか」です.
そのため, データ型別に初期化時の挙動がまとめられた記事があると便利だろうと考え,
この記事を書くことにしました.

### 記法と約束

この記事では C++11 に従います.
正確には, N3337 に従います.
以下, 単にこれを C++ と呼びます.

C++ の規格の参照箇所を指定するために `[expr.call]/2` のような記法を使うことにします.
この例では「N3337 において `[expr.call]` とラベル付けされた節 (これは 5.2.2 節 "function call" のことです) の第2段落」を指します.

訳語の選択は xxxxxxxxxx に従います.

### C++ のデータ型の区分

C++ の初期化では, 型の区分を意識する必要があります.
ここで, 型の区分とは以下のものです.

* スカラー型
*

以下に挙げる型, ならびにそれらの CV 修飾された変種を総称して *スカラー型* といいます.

* 算術型
* enum 型
* ポインター型
* メンバーポインター型
* ヌルポインター型 (`std::nullptr_t`)

### C++ における初期化

初期化の際には, destination type と source type が決まっています (`[dcl.init]/16`).

C++ の初期化にはいろいろな種類のものがありますが,
この記事では便宜的にこれらを2種類に分けることにします.
ひとつは「初期化の動作」で, もうひとつは「初期化の文法」です.

ここで, 初期化の動作とは, 次のものを指します.

* ゼロ初期化 (zero-initialization, `[dcl.init]/5`)
* デフォルト初期化 (default-initialization, `[dcl.init]/6`)
* 値初期化 (value-initialization, `[dcl.init]/7`)

一方, 初期化の文法とは, 次のものを指します.

* コピー初期化 (copy-initialization, `[dcl.init]/14`)
* 直接初期化 (direct-initialization, `[dcl.init]/15`)
* リスト初期化 (list-initialization, `[dcl.init.list]/16`)

## destination type 別にみる初期化時の挙動

以下, destination type を `T` とします.

### スカラー型

### lvalue リファレンス型

リファレンスの初期化に関する情報は 8.5.3 節 "References" にまとめられています.
この場合 `T` は lvalue リファレンス型であるので,
`T` が参照 (refer) している型を `U` とおきます
(すなわち, `T` は `U &` です).

#### 初期化子がないとき

```
int &ri;
```

#### リスト初期化のとき

初期化子が braced-init-list のときは,
`[dcl.init.list]/3.5` (8.5.4 節 "List-initialization" の "(3.5)" と書かれた段落) が適用されます.

初期化子が rvalue であるので,
`T` が非 const lvalue リファレンス型である場合プログラムは不適格です (たぶん) (`[dcl.init.list]/3.5`).
以下, `T` が const lvalue リファレンス型である場合, すなわち `U` が const 修飾されている場合のみ考えます.

このとき当該の初期化子リストによって `U` 型の新しい一時オブジェクトがリスト初期化され,
初期化対象のリファレンスはその一時オブジェクトを参照するよう設定されます.

例1.

```
int const &rci = {};
```

このとき `int const` 型の一時オブジェクトが `{}` によってリスト初期化され,
`rci` はそれを参照するよう設定されます.
一時オブジェクトは `0` に値初期化されます (`[dcl.init.list]/3.7`, `[dcl.init]/7.4`, `[dcl.init]/5.1`),

例2.

### rvalue リファレンス型

リファレンスの初期化に関する情報は 8.5.3 節 "References" にまとめられています.
この場合 `T` は rvalue リファレンス型であるので,
`T` が参照 (refer) している型を `U` とおきます
(すなわち, `T` は `U &&` です).

### 文字配列型

### 文字配列型以外の配列型

### クラス型
